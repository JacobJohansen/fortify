import{r,c as t,h as e,g as i,H as o}from"./p-2b60d672.js";import{C as a}from"./p-29765681.js";import{l as c,g as n}from"./p-ac8be569.js";var s,l=/iPhone/i,h=/iPod/i,p=/iPad/i,u=/\biOS-universal(?:.+)Mac\b/i,d=/\bAndroid(?:.+)Mobile\b/i,g=/Android/i,b=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,f=/Silk/i,y=/Windows Phone/i,_=/\bWindows(?:.+)ARM\b/i,v=/BlackBerry/i,w=/BB10/i,k=/Opera Mini/i,m=/\b(CriOS|Chrome)(?:.+)Mobile/i,x=/Mobile(?:.+)Firefox\b/i,C=function(r){return void 0!==r&&"MacIntel"===r.platform&&"number"==typeof r.maxTouchPoints&&r.maxTouchPoints>1&&"undefined"==typeof MSStream};!function(r){r.PROVIDERS_ADDED="providers:added",r.PROVIDERS_REMOVED="providers:removed",r.CLOSE="close",r.CONNECTION_PENDING="connection:pending",r.CONNECTION_RESOLVED="connection:resolved",r.CONNECTION_NOT_SUPPORTED="connection:not_supported",r.CONNECTION_REJECTED="connection:rejected",r.CHALLENGE_PENDING="challenge:pending",r.CHALLENGE_RESOLVED="challenge:resolved",r.CHALLENGE_REJECTED="challenge:rejected",r.DATA_CERTIFICATES_PENDING="data:certificates:pending",r.DATA_CERTIFICATES_RESOLVED="data:certificates:resolved",r.DATA_PROVIDERS_PENDING="data:providers:pending",r.DATA_PROVIDERS_RESOLVED="data:providers:resolved"}(s||(s={}));var F,E,S,A,M=function(r,t){if(!t.has(r))throw new TypeError("attempted to get private field on non-instance");return t.get(r)},P=function(r,t,e){if(!t.has(r))throw new TypeError("attempted to set private field on non-instance");return t.set(r,e),e};class z{constructor(r){F.set(this,void 0),E.set(this,void 0),S.set(this,function(r){var t={userAgent:"",platform:"",maxTouchPoints:0};r||"undefined"==typeof navigator?"string"==typeof r?t.userAgent=r:r&&r.userAgent&&(t={userAgent:r.userAgent,platform:r.platform,maxTouchPoints:r.maxTouchPoints||0}):t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var e=t.userAgent,i=e.split("[FBAN");void 0!==i[1]&&(e=i[0]),void 0!==(i=e.split("Twitter"))[1]&&(e=i[0]);var o=function(r){return function(t){return t.test(r)}}(e),a={apple:{phone:o(l)&&!o(y),ipod:o(h),tablet:!o(l)&&(o(p)||C(t))&&!o(y),universal:o(u),device:(o(l)||o(h)||o(p)||o(u)||C(t))&&!o(y)},amazon:{phone:o(b),tablet:!o(b)&&o(f),device:o(b)||o(f)},android:{phone:!o(y)&&o(b)||!o(y)&&o(d),tablet:!o(y)&&!o(b)&&!o(d)&&(o(f)||o(g)),device:!o(y)&&(o(b)||o(f)||o(d)||o(g))||o(/\bokhttp\b/i)},windows:{phone:o(y),tablet:o(_),device:o(y)||o(_)},other:{blackberry:o(v),blackberry10:o(w),opera:o(k),firefox:o(x),chrome:o(m),device:o(v)||o(w)||o(k)||o(x)||o(m)},any:!1,phone:!1,tablet:!1};return a.any=a.apple.device||a.android.device||a.windows.device||a.other.device,a.phone=a.apple.phone||a.android.phone||a.windows.phone,a.tablet=a.apple.tablet||a.android.tablet||a.windows.tablet,a}(window.navigator)),A.set(this,void 0),this.challenge="",this.options={logger:()=>{},filters:{},cryptoStorage:"browser"},r.logger&&(this.options.logger=r.logger),r.filters&&(this.options.filters=r.filters),r.cryptoStorage&&(this.options.cryptoStorage=r.cryptoStorage)}isConnectionSupported(){return!M(this,S).phone}static async hasConnection(){try{return(await fetch("https://127.0.0.1:31337/.well-known/webcrypto-socket")).ok}catch(r){return!1}}async checkHasConnection(){return new Promise(r=>{const t=async()=>{await z.hasConnection()?r():P(this,A,window.setTimeout(t,1e4))};t()})}async tryChallenge(){return await M(this,F).isLoggedIn()?null:M(this,F).challenge()}async login(){await M(this,F).login()}async connect(){return M(this,E)||P(this,E,"browser"===this.options.cryptoStorage?await WebcryptoSocket.BrowserStorage.create():new WebcryptoSocket.MemoryStorage),new Promise((r,t)=>{M(this,F)&&r(),P(this,F,new WebcryptoSocket.SocketProvider({storage:M(this,E)}).connect("127.0.0.1:31337").on("error",r=>{console.log(r),t()}).on("listening",async()=>{r()}).on("token",async r=>{r.added.length&&this.options.logger(s.PROVIDERS_ADDED,r.added),r.removed.length&&this.options.logger(s.PROVIDERS_REMOVED,r.removed)}).on("disconnect",()=>{console.log("disconnect")}).on("close",()=>{this.options.logger(s.CLOSE)}))})}disconnect(){M(this,F)&&(M(this,F).client.close(),P(this,F,null)),M(this,A)&&(clearTimeout(M(this,A)),P(this,A,null))}async start(){this.options.logger(s.CONNECTION_PENDING),this.isConnectionSupported()?(await z.hasConnection()||this.options.logger(s.CONNECTION_REJECTED),await this.checkHasConnection(),await this.connect(),await this.tryLogin()):this.options.logger(s.CONNECTION_NOT_SUPPORTED)}async tryLogin(){const r=await this.tryChallenge();if(r){this.challenge=r,this.options.logger(s.CHALLENGE_PENDING);try{await this.login(),this.challenge=void 0,this.options.logger(s.CHALLENGE_RESOLVED)}catch(t){return this.challenge=void 0,void this.options.logger(s.CHALLENGE_REJECTED)}}this.options.logger(s.CONNECTION_RESOLVED)}isProviderValid(r){const{filters:t}=this.options;return!(t&&t.onlyRemote&&!r.isRemovable)}async getProvidersInfo(){return(await M(this,F).info()).providers.filter(r=>this.isProviderValid(r))}async getProviderById(r){const t=await M(this,F).getCrypto(r);if(!(await t.isLoggedIn()))try{await t.login()}catch(e){return}return t}isCertificateValid(r,t,e){const{filters:i}=this.options;return!(!i.expired&&r.notAfter.getTime()<Date.now()||!e.filter(r=>{const e=r.split("-");return"private"===e[0]&&e[2]===t.split("-")[2]})[0]||i.emailMatch&&!r.subjectName.includes(i.emailMatch))}async getCertificatesById(r){const t=await this.getProviderById(r);if(!t)return;const e=[],i=await t.keyStorage.keys(),o=await t.certStorage.keys();for(const a of o){if("x509"!==a.split("-")[0])continue;const r=await t.certStorage.getItem(a);this.isCertificateValid(r,a,i)&&(r.id=a,r.subject=z.getSubjectIssuerValue(r.subjectName),r.issuer=z.getSubjectIssuerValue(r.issuerName),e.push(r))}return e}async getCertificateBodyById(r,t){const e=await this.getProviderById(r);if(!e)return;const i=await e.certStorage.getItem(t),o=await e.certStorage.exportCert("raw",i);return a.ToBase64(o)}static getSubjectIssuerValue(r){const t={};return r.split(/, /g).forEach(r=>{const e=r.split("=");t[e[0]]=e[1]}),t}}F=new WeakMap,E=new WeakMap,S=new WeakMap,A=new WeakMap;var B,T=function(r,t){if(!t.has(r))throw new TypeError("attempted to get private field on non-instance");return t.get(r)};class W{constructor(r){this.certificates=[],this.providers=[],B.set(this,void 0),function(r,t,e){if(!t.has(r))throw new TypeError("attempted to set private field on non-instance");t.set(r,e)}(this,B,new z(r))}async start(){await T(this,B).start()}async tryLogin(){await T(this,B).tryLogin()}async getCertificateBodyById(r,t){return T(this,B).getCertificateBodyById(r,t)}getChallenge(){return T(this,B).challenge}finish(){T(this,B).disconnect(),this.certificates=[],this.providers=[]}selectCertificate(r){this.certificates=this.certificates.map(t=>{let e=!1;return t.id===r&&(e=!0),Object.assign(t,{selected:e}),t})}getSelectedCertificate(){return this.certificates.find(r=>r.selected)}async dataCertificates(){if(this.certificates=[],0!==this.providers.length){T(this,B).options.logger(s.DATA_CERTIFICATES_PENDING);for(const r of this.providers){const t=await T(this,B).getCertificatesById(r.id);t&&this.certificates.push(...t)}T(this,B).options.logger(s.DATA_CERTIFICATES_RESOLVED)}}async dataProviders(){T(this,B).options.logger(s.DATA_PROVIDERS_PENDING),this.providers=await T(this,B).getProvidersInfo(),T(this,B).options.logger(s.DATA_PROVIDERS_RESOLVED)}}B=new WeakMap;var I,j=function(r,t){if(!t.has(r))throw new TypeError("attempted to get private field on non-instance");return t.get(r)};const D=class{constructor(e){r(this,e),I.set(this,void 0),this.filters={},this.action=s.CONNECTION_PENDING,this.tick=0,this.onLog=async(r,t)=>{this.debug&&console.log({type:r,body:t}),r!==s.PROVIDERS_ADDED&&r!==s.PROVIDERS_REMOVED?(this.action=r,r===s.CONNECTION_RESOLVED&&j(this,I).dataProviders(),r===s.DATA_PROVIDERS_RESOLVED&&j(this,I).dataCertificates()):await j(this,I).dataProviders()},this.onClickCancel=()=>{this.cancel.emit()},this.onClickContinue=()=>{const r=j(this,I).getSelectedCertificate();r&&this.continue.emit({certificateId:r.id,providerId:r.providerID})},this.onClickUpdateCertificates=()=>{j(this,I).dataCertificates()},this.onClickTryAgain=()=>{j(this,I).tryLogin()},this.onClickCloseDetails=()=>{this.certificateBase64ForDetails=null},this.onClickCertificate=r=>{j(this,I).selectCertificate(r),this.tick+=1},this.onClickCertificateDetails=(r,t)=>{j(this,I).getCertificateBodyById(r,t).then(r=>{this.certificateBase64ForDetails=r})},this.cancel=t(this,"cancel",7),this.continue=t(this,"continue",7)}componentWillLoad(){c.setLocale(this.language)}async componentDidLoad(){(function(r,t,e){if(!t.has(r))throw new TypeError("attempted to set private field on non-instance");t.set(r,e)})(this,I,new W({logger:this.onLog,filters:this.filters,cryptoStorage:this.cryptoStorage})),await j(this,I).start()}componentDidUnload(){j(this,I).finish()}static renderConnecting(){return e("peculiar-fortify-connecting",null)}static renderFortifyAuthorization(r){return e("peculiar-fortify-authorization",{pin:r})}static renderFortifyNotDetected(){return e("peculiar-fortify-not-detected",null)}static renderFortifyNotSupported(){return e("peculiar-fortify-not-supported",null)}renderChallengeNotApproved(){return e("peculiar-fortify-challenge-not-approved",{onCancel:this.onClickCancel,onTryAgain:this.onClickTryAgain})}renderCertificates(){const r=this.action===s.DATA_CERTIFICATES_PENDING;let t;return r||(t=j(this,I).getSelectedCertificate()),e("peculiar-fortify-certificates-list",{certificates:j(this,I).certificates,onCertificate:this.onClickCertificate,onCertificateDetails:this.onClickCertificateDetails,onUpdate:this.onClickUpdateCertificates,onCancel:this.onClickCancel,onContinue:this.onClickContinue,loading:r,allowContinue:t})}renderProvidersEmpty(){return e("peculiar-fortify-providers-empty",{onCancel:this.onClickCancel})}renderUnresolvedStatus(){return e("peculiar-fortify-layout",{type:"message",titleValue:"Someting went wrong for status",descriptionValue:this.action})}render(){let r=null;switch(this.action){case s.CONNECTION_PENDING:case s.CONNECTION_RESOLVED:case s.DATA_PROVIDERS_PENDING:r=D.renderConnecting();break;case s.CONNECTION_REJECTED:case s.CLOSE:r=D.renderFortifyNotDetected(),this.certificateBase64ForDetails=null;break;case s.CONNECTION_NOT_SUPPORTED:r=D.renderFortifyNotSupported();break;case s.CHALLENGE_PENDING:r=D.renderFortifyAuthorization(j(this,I).getChallenge());break;case s.CHALLENGE_REJECTED:r=this.renderChallengeNotApproved();break;case s.DATA_PROVIDERS_RESOLVED:0===j(this,I).providers.length&&(r=this.renderProvidersEmpty());break;case s.DATA_CERTIFICATES_PENDING:case s.DATA_CERTIFICATES_RESOLVED:r=this.renderCertificates();break;default:r=this.renderUnresolvedStatus()}return this.action===s.DATA_PROVIDERS_PENDING&&j(this,I).providers.length&&(r=this.renderCertificates()),e(o,null,e("peculiar-fortify-layout",null,this.certificateBase64ForDetails&&e("div",{class:"container_details peculiar_fill_light"},e("header",{class:"container_details_header peculiar_stroke_grey_3"},e("peculiar-fortify-typography",{type:"h4",align:"center",ellipsis:!0},n("details.title")),e("peculiar-fortify-button",{class:"container_details_button",onClick:this.onClickCloseDetails,"aria-label":"Close details",size:"small"},e("img",{slot:"icon",src:i("../assets/back_icon.svg"),alt:"Back"}),n("actions.back"))),e("div",{class:"container_details_content"},e("peculiar-certificate-viewer",{certificate:this.certificateBase64ForDetails,view:"mobile"}))),r))}static get assetsDirs(){return["../../assets"]}};I=new WeakMap,D.style="*{-webkit-box-sizing:border-box;box-sizing:border-box}.peculiar_stroke_dark{border-color:#40484f;border-color:rgb(var(--peculiar-color-dark-rgb, 64, 72, 79))}.peculiar_fill_dark{background-color:#40484f;background-color:rgb(var(--peculiar-color-dark-rgb, 64, 72, 79))}.peculiar_color_dark{color:#40484f;color:rgb(var(--peculiar-color-dark-rgb, 64, 72, 79))}.peculiar_stroke_light{border-color:#ffffff;border-color:rgb(var(--peculiar-color-light-rgb, 255, 255, 255))}.peculiar_fill_light{background-color:#ffffff;background-color:rgb(var(--peculiar-color-light-rgb, 255, 255, 255))}.peculiar_color_light{color:#ffffff;color:rgb(var(--peculiar-color-light-rgb, 255, 255, 255))}.peculiar_stroke_grey_1{border-color:#FAF9F9;border-color:rgb(var(--peculiar-color-grey_1-rgb, 250, 249, 249))}.peculiar_fill_grey_1{background-color:#FAF9F9;background-color:rgb(var(--peculiar-color-grey_1-rgb, 250, 249, 249))}.peculiar_color_grey_1{color:#FAF9F9;color:rgb(var(--peculiar-color-grey_1-rgb, 250, 249, 249))}.peculiar_stroke_grey_2{border-color:#EEF4F7;border-color:rgb(var(--peculiar-color-grey_2-rgb, 238, 244, 247))}.peculiar_fill_grey_2{background-color:#EEF4F7;background-color:rgb(var(--peculiar-color-grey_2-rgb, 238, 244, 247))}.peculiar_color_grey_2{color:#EEF4F7;color:rgb(var(--peculiar-color-grey_2-rgb, 238, 244, 247))}.peculiar_stroke_grey_3{border-color:#E1E4E6;border-color:rgb(var(--peculiar-color-grey_3-rgb, 225, 228, 230))}.peculiar_fill_grey_3{background-color:#E1E4E6;background-color:rgb(var(--peculiar-color-grey_3-rgb, 225, 228, 230))}.peculiar_color_grey_3{color:#E1E4E6;color:rgb(var(--peculiar-color-grey_3-rgb, 225, 228, 230))}.peculiar_stroke_grey_4{border-color:#b6c3cc;border-color:rgb(var(--peculiar-color-grey_4-rgb, 182, 195, 204))}.peculiar_fill_grey_4{background-color:#b6c3cc;background-color:rgb(var(--peculiar-color-grey_4-rgb, 182, 195, 204))}.peculiar_color_grey_4{color:#b6c3cc;color:rgb(var(--peculiar-color-grey_4-rgb, 182, 195, 204))}.peculiar_stroke_grey_5{border-color:#6d7d87;border-color:rgb(var(--peculiar-color-grey_5-rgb, 109, 125, 135))}.peculiar_fill_grey_5{background-color:#6d7d87;background-color:rgb(var(--peculiar-color-grey_5-rgb, 109, 125, 135))}.peculiar_color_grey_5{color:#6d7d87;color:rgb(var(--peculiar-color-grey_5-rgb, 109, 125, 135))}.peculiar_stroke_secondary{border-color:#0abe65;border-color:rgb(var(--peculiar-color-secondary-rgb, 10, 190, 101))}.peculiar_fill_secondary{background-color:#0abe65;background-color:rgb(var(--peculiar-color-secondary-rgb, 10, 190, 101))}.peculiar_color_secondary{color:#0abe65;color:rgb(var(--peculiar-color-secondary-rgb, 10, 190, 101))}.peculiar_stroke_primary{border-color:#0680ff;border-color:rgb(var(--peculiar-color-primary-rgb, 6, 128, 255))}.peculiar_fill_primary{background-color:#0680ff;background-color:rgb(var(--peculiar-color-primary-rgb, 6, 128, 255))}.peculiar_color_primary{color:#0680ff;color:rgb(var(--peculiar-color-primary-rgb, 6, 128, 255))}.peculiar_stroke_attention{border-color:#F7A831;border-color:rgb(var(--peculiar-color-attention-rgb, 247, 168, 49))}.peculiar_fill_attention{background-color:#F7A831;background-color:rgb(var(--peculiar-color-attention-rgb, 247, 168, 49))}.peculiar_color_attention{color:#F7A831;color:rgb(var(--peculiar-color-attention-rgb, 247, 168, 49))}.peculiar_h4{font-size:17px;line-height:1.4;font-weight:600;letter-spacing:0.188889px}.peculiar_h6{font-size:15px;line-height:20px;font-weight:600;letter-spacing:0.3px}.peculiar_h7{font-size:14px;line-height:1.35;font-weight:600;letter-spacing:0px}.peculiar_b1{font-size:15px;line-height:1.46;font-weight:400;letter-spacing:0.3px}.peculiar_b3{font-size:13px;line-height:1.5;font-weight:400;letter-spacing:0.03em}.peculiar_c1{font-size:11px;line-height:1.36;font-weight:400;letter-spacing:0.03em}peculiar-fortify-button+peculiar-fortify-button{margin-left:10px}:host{display:block}.container_details{position:absolute;width:100%;height:100%;top:0;left:0;z-index:1}.container_details_header{border-bottom-width:1px;border-bottom-style:solid;padding:10px 100px;position:relative;height:45px}.container_details_button{position:absolute;top:50%;left:8px;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.container_details_content{height:calc(100% - 45px);overflow:auto}";export{D as peculiar_fortify_certificates}